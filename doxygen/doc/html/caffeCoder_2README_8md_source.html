<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>himrep: C:/dev/icub-contrib-iit/himrep/modules/caffeCoder/README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">himrep
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">C:/dev/icub-contrib-iit/himrep/modules/caffeCoder/README.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Table of Contents</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;=================</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  * [Description](#description)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  * [Installation](#installation)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    * [Dependencies](#dependencies)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    * [Compilation](#compilation)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  * [Setup](#setup)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    * [Download binary Caffe models (.caffemodel)](#download-binary-caffe-models-caffemodel)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    * [Configure .prototxt and .ini with absolute paths](#configure-prototxt-and-ini-with-absolute-paths)</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  * [Detailed explanation](#detailed-explanation)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  * [Additional notes on Caffe installation](#additional-notes-on-caffe-installation)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  * [Citation](#citation)</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  * [License](#license)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;## Description</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;This module is a basic YARP wrapper for [Caffe](http://caffe.berkeleyvision.org/), which receives as input a stream of images (of type `yarp::sig::Image`), feeds them to a Convolutional Neural Network (CNN) model and produces as output a corresponding stream of vectors (of type `yarp::sig::Vector`), which can be extracted from any CNN layer.</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;## Installation</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;### Dependencies</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;The libraries that are needed to compile this module are:</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;- [YARP](https://github.com/robotology/yarp)</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;- [iCub](https://github.com/robotology/icub-main)</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;- [OpenCV](http://opencv.org/releases.html)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;- [Caffe](https://www.github.com/BVLC/caffe.git)</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;- [CUDA](https://developer.nvidia.com/cuda-zone):</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;this is an optional dependency of Caffe and also of this module. However, we strongly recommend to rely on a powerful enough NVIDIA CUDA-enabled GPU (with Compute Capability &gt;= 3.0) in order to achieve a good frame rate.</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;### Compilation</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;Provided that the dependencies are satified, you can compile this module just by setting the `BUILD_caffeCoder` flag to `ON` as explained [here](https://www.github.com/robotology/himrep#compilation).</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;When you run the `ccmake` command, ensure also that:</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;- the `Caffe_DIR` flag is correctly pointing to a valid Caffe installation</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;- the flag `CUDA_USE_STATIC_CUDA_RUNTIME` is set to `OFF`</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;## Setup</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;This module can use arbitrary Caffe models: the only contraint is that the model must have an input data layer of kind [MemoryData](http://caffe.berkeleyvision.org/tutorial/layers/memorydata.html). However, this can be easily achieved for most models just by replacing the input data layer in the model definition file. In the following, we report istructions on how to setup the module to use either one of two well-known models, `ResNet-50` and `CaffeNet`.</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;The setup procedure basically follows the [Extracting Features](http://caffe.berkeleyvision.org/gathered/examples/feature_extraction.html) example provided with Caffe. If you are not interested in the details, you can execute the following instructions and use one of these two models with the default module parameters. We provide a little more explanataion hereafter for those who want to try different or custom Caffe models and settings.</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;### Download binary Caffe models (.caffemodel)</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;If you don&#39;t have setted it already, for convenience, set the `Caffe_ROOT` env variable pointing to your `caffe` source code directory.</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;For `CaffeNet` we can follow the instructions on [caffe](http://caffe.berkeleyvision.org/model_zoo.html) website:</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;~~~</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;$ cd $Caffe_ROOT</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;$ scripts/download_model_binary.py models/bvlc_reference_caffenet</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;# for this model we need also to get the mean image of the training set of ILSVRC</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;$ ./data/ilsvrc12/get_ilsvrc_aux.sh</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;~~~</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;For `ResNet-50` we can get the weights as indicated [here](https://github.com/KaimingHe/deep-residual-networks):</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;~~~</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;$ cd $Caffe_ROOT/models</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;$ mkdir ResNet50</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;$ cd ResNet50</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;~~~</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;by downloading, in this folder, the `ResNet-50-model.caffemodel` file from the [OneDrive link](https://onedrive.live.com/?authkey=%21AAFW2-FVoxeVRck&amp;id=4006CBB8476FF777%2117887&amp;cid=4006CBB8476FF777) specified at the webpage.</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;### Configure .prototxt and .ini with absolute paths</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;We have now to customize two files in order to use the downloaded Caffe model.</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;These are provided for some Caffe models (the two considered here plus `GoogLeNet`) with the source code of the module (inside `app/conf`) and are:</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;- a `.ini` file for the `caffeCoder` module, specifying some parameters and pointing to the Caffe model&#39;s binary and definition files</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;- the `.prototxt` Caffe model&#39;s definition file, where we have replaced the input data layer with one of kind `MemoryData`</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;#### File .prototxt: configuration</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;Import the `.prototxt` files from `himrep` for the `CaffeNet` and `ResNet-50` architectures in order to customize them for your system:</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;~~~</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;$ yarp-config context --import himrep bvlc_reference_caffenet_val.prototxt</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;$ yarp-config context --import himrep resnet_val.prototxt</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;~~~</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;For `CaffeNet` we need to do:</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;~~~</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;$ cd ~/.local/share/yarp/contexts/himrep</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;$ gedit bvlc_reference_caffenet_val.prototxt</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;~~~</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;At line 10, replace the following:</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;~~~</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;mean_file: &quot;/path/to/train_mean.binaryproto&quot;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;~~~</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;with the correct absolute path to this file on your system (without using env variables). This is the binary file containing the mean image of the training set of ILSVRC we just downloaded. In this case this is:</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;~~~</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;mean_file: &quot;$Caffe_ROOT/data/ilsvrc12/imagenet_mean.binaryproto&quot;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;~~~</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;where you must replace the `$Caffe_ROOT` env variable with its full value.</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;For `ResNet-50` we do not need to modify anything.</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;#### File .ini: configuration</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;Import the `.ini` files from `himrep` for the `CaffeNet` and `ResNet-50` in order to customize them on your system:</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;~~~</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;# CaffeNet</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;$ yarp-config context --import himrep caffeCoder_caffenet.ini</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;$ yarp-config context --import himrep caffeCoder_resnet.ini</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;~~~</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;For each of them we must set the following variables to the correct paths: `caffemodel_file` and `prototxt_file`.</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;For `CaffeNet` do:</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;~~~</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;$ cd ~/.local/share/yarp/contexts/himrep</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;$ gedit caffeCoder_caffenet.ini</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;~~~</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;And then set:</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;~~~</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;caffemodel_file $Caffe_ROOT/models/bvlc_reference_caffenet/bvlc_reference_caffenet.caffemodel</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;prototxt_file ~/.local/share/yarp/contexts/himrep/bvlc_reference_caffenet_val.prototxt</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;~~~</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;replacing the `$Caffe_ROOT` env variable and `~/` with their full values.</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;For `ResNet-50` do:</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;~~~</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;gedit caffeCoder_resnet.ini</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;~~~</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;And then set:</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;~~~</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;caffemodel_file $Caffe_ROOT/models/ResNet50/ResNet-50-model.caffemodel</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;prototxt_file ~/.local/share/yarp/contexts/himrep/resnet_val.prototxt</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;~~~</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;replacing the `$Caffe_ROOT` env variable and `~/` with their full values.</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;For other parameters and input and output ports we refer to the module documentation [here](http://robotology.github.io/himrep/doxygen/doc/html/group__caffeCoder.html).</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;## Detailed explanation</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;In Caffe, the weights of network models are stored in a `.caffemodel` file, whose absolute path must be provided to the `caffeCoder` in the `caffemodel_file` parameter. The network definition file to be used in inference mode instead is usually called `deploy.prototxt` and must be provided to the `caffeCoder` in the `prototxt_file` parameter.</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;In Caffe&#39;s [Model Zoo](http://caffe.berkeleyvision.org/model_zoo.html) there are many models available with related descriptions and usage instructions. You can use them with `caffeCoder`, by copying their `deploy.prototxt` and replacing their input layer with a corresponding `MemoryData` layer.</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;In order to correctly use a network in inference mode, the mean image (or pixel) of the training set that has been used to learn the model parameters must be subtracted from any image that is fed to the model. The mean image is usully stored in Caffe with a `.binaryproto` file. You will to specify this in the `MemoryData` layer and:</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;- if the mean image is subtracted, the `.binaryproto` file must be downloaded and correctly pointed by the `.prototxt` in your system (`mean_file` field of the `MemoryData` layer);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;- if the mean pixel is subtracted, you will need to specify, in the `.ini` file, two additional parameters (as, e.g., we do in `caffeCoder_googlenet.ini`) related to the width and height (`resizeWidth` and `resizeHeight`) to which the input image will be resized before being fed to the `MemoryData` layer.</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;Another important parameter to be set in the `.ini` file is the tag/name of the output of the layer we want to read. This can be specified by setting the `blob_name` parameter.</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;## Additional notes on Caffe installation</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;For a complete and continuously updated guide to how to install Caffe in any configuration you should go to [Caffe - Installation](http://caffe.berkeleyvision.org/installation.html).</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;We do not cover here exhaustively the procedure. We just report the procedure we followed at present (07/2017) to use Caffe from this module on Ubuntu 16.04 LTS.</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;##### CUDA installation</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;Download and install CUDA drivers and toolkit by following [CUDA Installation Guide for Linux](http://docs.nvidia.com/cuda/cuda-installation-guide-linux/#axzz4BkDT7m6r).</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;##### cuDNN installation (optional but recommended)</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;Download the **cuDNN** version you need (depending on the toolkit version) from [NVIDIA cuDNN library](https://developer.nvidia.com/cuDNN) (you have to sign up as CUDA Registered Developer, it&#39;s for free), and install it by following the instructions.</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;##### BLAS installation</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;We chose the **OpenBLAS** implementation but also ATLAS or Intel MKL are supported by Caffe.</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;You can either download the source code from [OpenBLAS page](http://www.openblas.net/) and follow instructions to compile and install it, or install the package.</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;In the latter case, you can just do:</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;```</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;sudo apt-get install libopenblas-dev</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;```</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;In case you compile the source code, we recommend to install in a separate and specified location of your choice instead of the default `/usr/local` by doing:</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;```</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;tar -xzvf &lt;downloaded-openblas-archive-name&gt;.tar.gz</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;cd &lt;downloaded-openblas-archive-name&gt;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;make PREFIX=/path/to/install/dir install</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;```</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;and setting the `OpenBLAS_HOME` environment variable to the installation path to allow Caffe finding it.</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;##### BOOST installation</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;As for BLAS, you can either download the source code from [Boost C++ Libraries](http://www.boost.org/) and follow instructions to compile and install it, or install the package. In any case, check the supported versions on Caffe website.</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;For convenience, again we report the followed instructions (that can be found on Boost page) to compile from source:</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;```</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;tar --bzip2 -xf &lt;downloaded-boost-archive&gt;.tar.bz2</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;cd &lt;downloaded-boost-archive&gt;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;./bootstrap.sh --prefix=path/to/install/dir</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;./b2 install</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;```</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;and set the `Boost_DIR` environment variable to the installation path to allow Caffe finding it, or to download the package:</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;```</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;sudo apt-get install libboost-all-dev</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;```</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;##### OpenCV installation</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;OpenCV comes with the `icub-common` package. In case you need to compile it from source, you can download the source code from [OpenCV - Downloads](http://opencv.org/downloads.html) and compile it through the usual:</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;```</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;unzip &lt;downloaded-opencv-archive-name&gt;.zip</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;cd &lt;downloaded-opencv-archive-name&gt;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;mkdir build &amp;&amp; cd build</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;ccmake ../</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;make</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;make install</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;```</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;Where in the CMake configuration you should have set the installation path (`CMAKE\_INSTALL\_PREFIX`) to one of your choice. In this case, set the `OpenCV_DIR` environment variable to the installation path to allow Caffe finding it.</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;##### Other packages</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;Refer to [Caffe - Ubuntu Installation](http://caffe.berkeleyvision.org/install_apt.html) for updated instructions or manual installation. On Ubunutu 16.04 LTS at the time being we have done:</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;Google Protobuf Buffers C++:&lt;br&gt;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;`sudo apt-get install libprotobuf-dev protobuf-compiler`</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;Google Logging:&lt;br&gt;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;`sudo apt-get install libgoogle-glog-dev`</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;Google Flags:&lt;br&gt;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;`sudo apt-get install libgflags-dev`</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;LevelDB:&lt;br&gt;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;`sudo apt-get install libleveldb-dev`</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;HDF5:&lt;br&gt;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;`sudo apt-get install libhdf5-serial-dev`</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;LMDB:&lt;br&gt;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;`sudo apt-get install liblmdb-dev`</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;snappy:&lt;br&gt;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;`sudo apt-get install libsnappy-dev`</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;##### Caffe compilation</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;Since Caffe is under active development, we try to be compatible with the changes progressively introduced in the framework and periodically check the compatibility of `caffeCoder` against its `master` branch. Therefore you can refer to it and clone it:</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;```</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;git clone https://www.github.com/BVLC/caffe.git</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;```</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;Note that at present [Caffe RC3](https://github.com/BVLC/caffe/releases) is not compatible anymore with `caffeCoder`.</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;In order to be able to link Caffe from an external project via CMake (as this application does) you should compile Caffe via CMake and not manually editing the Makefile.config.</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;Related instructions can be found at [Caffe - Installation](http://caffe.berkeleyvision.org/installation.html) or [here](https://github.com/BVLC/caffe/pull/1667). Generally you can do:</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;```</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;cd caffe</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;mkdir build</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;cd build</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;ccmake ../ (NOTE *)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;make all</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;make runtest</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;make install</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;```</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;**NOTE** In the configuration step:</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;- you should be able to link to all installed dependencies, if you have set correctly the environment variables</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;- set BLAS to `open` or `Open` if you installed OpenBLAS as we did: if you still see that the Atlas implementation is not found, this might be an issue with Caffe: in any case, if you check by toggling the advanced mode, you should see that OpenBLAS has been found in your installation directory</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;- there is no need to build the Matlab wrapper for Caffe</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;- use the cuDNN library if possible (set USE_CUDNN to ON)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;- **important if you are on Ubuntu 16.04 and use GCC 5.3 with CUDA 7.5**: as noted [here](https://github.com/BVLC/caffe/issues/4046), in this case you need to modify the `CMAKE_CXX_FLAGS` CMake variable by appending to it the `-D_FORCE_INLINES` flag. You can do it during the interactive configuration step with `ccmake` or by modifying the following line in the `CMakeLists.txt`:</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;   ```</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;   set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -fPIC -D_FORCE_INLINES -Wall&quot;)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   ```</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;Finally, set the `Caffe_DIR` environment variable to the installation path to allow finding Caffe via `find_package`.</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;## Citation</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;This module has been presented and benchmarked in the iCub scenario in the following paper:</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;[Teaching iCub to recognize objects using deep Convolutional Neural Networks](http://jmlr.csail.mit.edu/proceedings/papers/v43/pasquale15.pdf) *Giulia Pasquale, Carlo Ciliberto, Francesca Odone, Lorenzo Rosasco and Lorenzo Natale*,</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;Proceedings of The 4th Workshop on Machine Learning for Interactive Systems, pp. 21–25, 2015</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    @inproceedings{pasquale15,</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;   author  = {Giulia Pasquale and Carlo Ciliberto and Francesca Odone and Lorenzo Rosasco and Lorenzo Natale},</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   title   = {Teaching iCub to recognize objects using deep Convolutional Neural Networks},</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;   journal = {Proceedings of the 4th Workshop on Machine Learning for Interactive Systems, 32nd International Conference on Machine Learning},</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;   year    = {2015},</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;   volume  = {43},</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   pages   = {21--25},</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   url     = {http://www.jmlr.org/proceedings/papers/v43/pasquale15}</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;   }</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;## License</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;Material included here is Copyright of _iCub Facility - Istituto Italiano di Tecnologia_ and is released under the terms of the GPL v2.0 or later. See the file LICENSE for details.</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
